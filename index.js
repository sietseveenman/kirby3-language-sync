(function(){"use strict";var g=function(){var e=this,s=e.$createElement,n=e._self._c||s;return n("section",{staticClass:"k-sync-language-field"},[n("div",{staticClass:"k-field-label"},[e._v(e._s(e.label))]),n("k-button",{staticClass:"da-button",attrs:{icon:e.buttonIcon},on:{click:function(o){return e.$refs.dialog.open()}}},[e._v(" "+e._s(e.buttonLabel||"Synchronize")+" ")]),n("k-dialog",{ref:"dialog",attrs:{size:"small"}},[n("div",[n("k-select-field",{staticClass:"mb",attrs:{options:e.otherLanguages,required:!0,label:"Select source language",name:"sync_from",help:"From which language would you like to synchronize content from?"},model:{value:e.syncFromLanguage,callback:function(o){e.syncFromLanguage=o},expression:"syncFromLanguage"}}),n("k-checkboxes-field",{attrs:{label:"Fields to synchronize",options:e.syncableFields},model:{value:e.fieldsToSync,callback:function(o){e.fieldsToSync=o},expression:"fieldsToSync"}}),n("k-button",{staticClass:"uncheck-button",attrs:{icon:"cancel-small"},on:{click:function(o){e.fieldsToSync=[]}}},[e._v(" Uncheck all ")]),e.failed?n("k-text",{staticClass:"mt",staticStyle:{color:"var(--color-negative)"},attrs:{size:"small"}},[n("b",[e._v("! whoops, something went wrong")])]):e._e()],1),n("template",{slot:"footer"},[n("k-button-group",[n("k-button",{attrs:{icon:"cancel"},on:{click:function(o){return e.$refs.dialog.close()}}},[e._v("Stop")]),e.allowSync?n("k-button",{attrs:{icon:"play"},on:{click:e.getContentFromLanguage}},[e._v("Let's GO!")]):e._e()],1)],1)],2)],1)},_=[],F="",C="";function h(e,s,n,o,r,c,u,b){var t=typeof e=="function"?e.options:e;s&&(t.render=s,t.staticRenderFns=n,t._compiled=!0),o&&(t.functional=!0),c&&(t._scopeId="data-v-"+c);var i;if(u?(i=function(a){a=a||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!a&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(a=__VUE_SSR_CONTEXT__),r&&r.call(this,a),a&&a._registeredComponents&&a._registeredComponents.add(u)},t._ssrRegister=i):r&&(i=b?function(){r.call(this,(t.functional?this.parent:this).$root.$options.shadowRoot)}:r),i)if(t.functional){t._injectStyles=i;var S=t.render;t.render=function(k,f){return i.call(f),S(k,f)}}else{var d=t.beforeCreate;t.beforeCreate=d?[].concat(d,i):[i]}return{exports:e,options:t}}const v={props:{label:String,buttonLabel:String,buttonIcon:String,pageID:String,pageFields:Array,languages:Array},data(){return{syncFromLanguage:null,fieldsToSync:[],failed:!1}},computed:{allowSync(){return this.syncFromLanguage&&this.fieldsToSync.length},otherLanguages(){return this.languages?Object.entries(this.languages).filter(e=>e[0]!==this.$language.code).map(e=>({value:e[0],text:e[1]})):[]},syncableFields(){return this.pageFields.map(e=>({value:e.name,text:e.label}))}},mounted(){this.pageFields.forEach(e=>this.fieldsToSync.push(e.name))},methods:{syncFields(e){try{e.forEach(s=>{this.fieldsToSync.includes(s.name)&&this.$store.dispatch("content/update",[s.name,s.value])}),this.$refs.dialog.close()}catch(s){console.error(s),this.failed=!0}},getContentFromLanguage(){this.$api.post(`sync-lang/${encodeURIComponent(this.pageID)}`,{fromLang:this.syncFromLanguage}).then(e=>{e.success?this.syncFields(e.content):(console.error("Response:",e),this.failed=!0)}).catch(e=>{console.error(e),this.failed=!0})}}},l={};var p=h(v,g,_,!1,y,"2558e4ff",null,null);function y(e){for(let s in l)this[s]=l[s]}var m=function(){return p.exports}();window.panel.plugin("sietseveenman/kirby3-language-sync",{fields:{sync:m}})})();
